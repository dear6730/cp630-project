sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/core/format/NumberFormat","sap/ui/core/format/DateFormat"],function(e,t,a){"use strict";var r={style:"short",decimals:1,shortDecimals:2};var o=t.getFloatInstance(r);var s=a.getDateInstance({pattern:"MMM d, y"});return e.extend("ec.laurier.imad.controller.Dashboard",{onInit:function(){this.populateTotalStockValue();this.populateTotalStockValueByCategory();this.populateTop5ProductsSold();this.populateOverviewStockingIssues();this.populateCurrentStateOfStock();this.populateCombinedPercentageHistory()},populateTotalStockValue:function(){var e=this.getView().byId("totalStockValue");var t=this.getView().getModel("cardModel");var a=t.getProperty("/totalStockValue");var r;var c=[];var n=[];$.when($.ajax({url:"/imad-rs/rest/card1",dataType:"json",success:function(e){r=e.results.header;c=e.results.list;n=e.results.measures}})).then(function(){if(r!==null&&c.length>0&&n.length>0){r.n="$"+o.format(r.n);a["sap.card"].header.title="Total Stock value";a["sap.card"].header.details="as of "+s.format(new Date(r.details));a["sap.card"].header.data.json=r;a["sap.card"].content.data.json.list=c;a["sap.card"].content.measures=n;t.setProperty("/totalStockValue",a);e.refresh()}})},populateTotalStockValueByCategory:function(){var e=this.getView().byId("totalStockValueByCategory");var t=this.getView().getModel("cardModel");var a=t.getProperty("/totalStockValueByCategory");var r=[];$.ajax({url:"/imad-rs/rest/card2",dataType:"json",success:function(o){r=o.results;if(r.length>0){a["sap.card"].header.title="Total Stock by Category";a["sap.card"].content.data.json.measures=r;t.setProperty("/totalStockValueByCategory",a);e.refresh()}}})},populateTop5ProductsSold:function(){var e=this.getView().byId("top5ProductsSold");var t=this.getView().getModel("cardModel");var a=t.getProperty("/top5ProductsSold");var r=[];$.ajax({url:"/imad-rs/rest/card3",dataType:"json",success:function(o){r=o.results;if(r.length>0){a["sap.card"].header.title="Stock Value of Top 5 Products";a["sap.card"].content.data.json.list=r;t.setProperty("/top5ProductsSold",a);e.refresh()}}})},populateOverviewStockingIssues:function(){var e=this.getView().byId("overviewStockingIssues");var t=this.getView().getModel("cardModel");var a=t.getProperty("/overviewStockingIssues");var r=[];$.ajax({url:"/imad-rs/rest/card4",dataType:"json",success:function(o){r=o.results;if(r.length>0){var s=r[0]["outOfStockPercentage"];var c=r[0]["nearlyOutOfStockPercentage"];var n=r[0]["combinedPercentage"];a["sap.card"].header.title="Global Stocking Issues";a["sap.card"].content.body[1]["inlines"][0]["text"]=s+"%";a["sap.card"].content.body[3]["inlines"][0]["text"]=c+"%";a["sap.card"].content.body[6]["inlines"][0]["text"]=n+"%";t.setProperty("/overviewStockingIssues",a);e.refresh()}}})},populateCurrentStateOfStock:function(){var e=this.getView().byId("currentStateOfStock");var t=this.getView().getModel("cardModel");var a=t.getProperty("/currentStateOfStock");var r=[];$.ajax({url:"/imad-rs/rest/card5",dataType:"json",success:function(o){r=o.results;if(r.length>0){a["sap.card"].header.title="Products Out of Stock, or Nearly Out of Stock";a["sap.card"].header.subTitle=s.format(new Date);a["sap.card"].data.json.results=r;t.setProperty("/currentStateOfStock",a);e.refresh()}}})},populateCombinedPercentageHistory:function(){var e=this.getView().byId("combinedPercentageHistory");var t=this.getView().getModel("cardModel");var a=t.getProperty("/combinedPercentageHistory");var r=[];var o=[];$.when($.ajax({url:"/imad-rs/rest/card6Header",dataType:"json",success:function(e){r=e.results}}),$.ajax({url:"/imad-rs/rest/card6",dataType:"json",success:function(e){o=e.results}})).then(function(){if(r.length>0&&o.length>0){a["sap.card"].header.title="Historical Analysis of Global Combined Percentage";a["sap.card"].header.data.json["number"]=r[0]["number"];a["sap.card"].header.data.json["trend"]=r[0]["trend"];a["sap.card"].header.data.json["state"]=r[0]["state"];a["sap.card"].content.data.json.list=o;t.setProperty("/combinedPercentageHistory",a);e.refresh()}})}})});